<!DOCTYPE html>
<html lang="zh-cn">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>标题</title>
    <link rel="stylesheet" href="./libs/bootstrap.css">
    <style></style>
</head>

<body>

    <div class="lw">
        <div class="top container pt-2 pb-2" style="display: flex;">
            <input type="text" placeholder="请输入歌曲名称" class="inp form-control">
            <button class="btn_search btn btn-success" style="width: 100px;">搜索</button>
        </div>
        <div class="list container">
            <p class="msg" style="margin-top: 60px;font-size: 30px;text-align: center;">暂无搜索列表</p>
            <ul class="list_songs list-group list-group-flush ">

            </ul>
        </div>
        <div class="end">
            <audio src="" class="audio" controls style="display: none;"></audio>
        </div>
    </div>

    <script src="./libs/jq/jquery-3.7.1.js"></script>
    <script src="./link3.js"></script>
    <script>
        const template = arr => {
            $(".list_songs").html("")
            let str = ``
            arr && arr.forEach(item => {
                str += `
                <li class="list-group-item d-flex justify-content-between">
                    <div class="left">
                        ${item.name}-----------${item.id}
                    </div>
                    <div class="right">
                        <button class="btn btn-primary btn-sm btn_play" data-id="${item.id}">播放</button>
                    </div>
                </li>
                `

            })
            $(".list_songs").show()

            $(".list_songs").html(str)

        }

        const searchfun = (value) => {
            search(value).then(
                content => {
                    let { result: { songs } } = content
                    if (songs.length != 0) {
                        template(songs)
                        $(".msg").hide()
                        $(".inp").val("")
                    } else {
                        $(".msg").show()
                        $(".list_songs").hide()
                    }
                }
            )
        }
        $(() => {
            $(".btn_search").on("click", () => {
                let v1 = $(".inp").val()
                if (v1 == "") return
                searchfun(v1)
            })
            $(".inp").on("keydown", (event) => {
                let { code } = event
                if (code === "Enter") {
                    let v1 = $(".inp").val()
                    if (v1 == "") return
                    searchfun(v1)
                }
            })

            $(".list_songs").on("click", ".btn_play", (event) => {
                let btn = event.target
                let id = btn.getAttribute("data-id")
                if (id) {
                    let src = `https://music.163.com/song/media/outer/url?id=${id}.mp3`

                    $(".btn_play").addClass("btn-primary").removeClass("btn-danger")
                    $(".btn_play").html("播放")

                    if (btn.isOpen === undefined) {
                        $(".audio").attr("src", src)
                        $(".audio").get(0).play()
                        btn.isOpen = 1
                        $(btn).html("暂停")
                        $(btn).addClass("btn-danger").removeClass("btn-primary")

                    } else {
                        btn.isOpen = undefined
                        $(".audio").get(0).pause()
                        $(btn).html("播放")
                        $(btn).addClass("btn-primary").removeClass("btn-danger")
                    }
                }

            })
        })

    </script>
</body>

</html>